# 钢材高周疲劳预测系统 (HCF Prediction System)

## 📋 项目简介

这是一个基于机器学习的钢材高周疲劳预测系统，使用随机森林算法来预测钢材的疲劳极限和应力范围截距(SRI)。该系统提供了一个友好的Web界面，支持单独预测和批量预测两种模式。

## 🎯 项目目标

- 通过钢材的化学成分（C、P、S）和力学性能（YS、UTS）预测疲劳极限
- 预测应力范围截距(SRI)值
- 提供易于使用的Web界面进行交互式预测
- 支持Excel批量数据处理，提高工作效率

## 🏗️ 项目架构

```
HCF_Prediction/
└── pythonProject2/
    ├── app.py                    # Flask Web应用主程序
    ├── model_training.py         # 模型训练脚本
    ├── rf_fatigue_model.pkl      # 训练好的疲劳极限预测模型
    ├── rf_sri_model.pkl          # 训练好的SRI预测模型
    ├── dataset/                  # 数据集文件夹
    └── templates/                # Web前端页面
        ├── homepage.html         # 主页
        ├── material_selection.html # 材料选择页面
        ├── index.html            # 单独预测页面
        ├── batch_upload.html     # 批量预测页面
        └── ...
```

## 📊 输入特征说明

系统需要输入以下5个特征参数：

| 特征 | 名称 | 单位 | 说明 |
|------|------|------|------|
| C | 碳含量 | % | 钢材中的碳元素质量百分比 |
| P | 磷含量 | % | 钢材中的磷元素质量百分比 |
| S | 硫含量 | % | 钢材中的硫元素质量百分比 |
| YS | 屈服强度 | MPa | 材料的屈服强度 |
| UTS | 抗拉强度 | MPa | 材料的极限抗拉强度 |

## 📈 输出结果说明

系统将预测以下两个重要的疲劳性能指标：

| 输出 | 名称 | 单位 | 说明 |
|------|------|------|------|
| 疲劳极限 | Fatigue Limit | - | 材料在无限次循环载荷下不发生疲劳破坏的最大应力 |
| SRI | 应力范围截距 | MPa | S-N曲线在应力范围轴上的截距值 |

## 🚀 安装与使用

### 环境要求

- Python 3.7+
- Flask
- scikit-learn
- pandas
- openpyxl

### 安装步骤

1. **克隆项目**
   ```bash
   git clone <项目地址>
   cd HCF_Prediction
   ```

2. **安装依赖**
   ```bash
   pip install flask scikit-learn pandas openpyxl
   ```

3. **进入项目目录**
   ```bash
   cd HCF_Prediction/pythonProject2
   ```

### 使用方法

#### 方法一：启动Web应用

1. **运行Flask应用**
   ```bash
   python app.py
   ```

2. **访问Web界面**
   - 在浏览器中打开：http://127.0.0.1:5000

#### 功能导航

1. **主页选择**：选择"钢材高周疲劳预测"
2. **预测方式选择**：
   - **单独上传数据**：输入单个样本进行预测
   - **批量上传数据**：上传Excel文件进行批量预测

## 📄 批量预测功能详解

### Excel文件格式要求

**输入文件格式**：
- 文件类型：Excel文件（.xlsx 或 .xls）
- 第一行：列标题（C, P, S, YS, UTS，不区分大小写）
- 数据行：最多支持1000行数据
- 数据类型：所有数值必须为数字，不能包含空值

**示例输入文件**：
```
C      P      S      YS     UTS
0.15   0.025  0.020  350    500
0.20   0.030  0.015  400    550
0.25   0.020  0.025  450    600
```

### 输出文件格式

**输出文件将包含8列**：
1. C（原始数据）
2. P（原始数据）
3. S（原始数据）
4. YS（原始数据）
5. UTS（原始数据）
6. 疲劳极限（预测结果）
7. 疲劳极限(log10)（对数值）
8. SRI(MPa)（预测结果）

**示例输出文件**：
```
C      P      S      YS     UTS    疲劳极限      疲劳极限(log10)  SRI(MPa)
0.15   0.025  0.020  350    500    245.670       2.390          412.340
0.20   0.030  0.015  400    550    278.920       2.445          445.780
0.25   0.020  0.025  450    600    312.150       2.494          478.230
```

### 使用步骤

1. **准备Excel文件**：按照格式要求准备输入数据
2. **上传文件**：点击或拖拽Excel文件到上传区域
3. **开始预测**：点击"开始预测分析"按钮
4. **下载结果**：系统自动下载包含预测结果的Excel文件

## 🛠️ 技术栈

- **后端框架**: Flask
- **机器学习**: scikit-learn (随机森林算法)
- **数据处理**: pandas
- **Excel处理**: openpyxl
- **前端**: HTML5 + Bootstrap + JavaScript

## 📝 使用示例

### 单独预测示例
```
输入参数：
- C: 0.15%
- P: 0.025%
- S: 0.020%
- YS: 350 MPa
- UTS: 500 MPa

预测结果：
- 疲劳极限: 245.670
- SRI: 412.340 MPa
```

### 批量预测示例
- 输入：包含10个样本的Excel文件
- 输出：包含原始数据和预测结果的Excel文件（8列）
- 处理时间：通常在几秒内完成

## ⚠️ 注意事项

1. **输入范围**：请确保输入的特征值在合理范围内
2. **单位一致性**：严格按照说明中的单位输入数据
3. **文件大小**：批量预测支持最多1000行数据
4. **模型局限性**：预测结果仅供参考，实际应用中应结合其他因素综合考虑

## 🐛 常见问题解决

### 问题1：FileNotFoundError: rf_fatigue_model.pkl
**解决方案**：
- 确保模型文件存在于正确位置
- 重新运行 `model_training.py` 生成模型文件

### 问题2：Excel文件上传失败
**解决方案**：
- 检查文件格式是否为.xlsx或.xls
- 确认文件包含正确的5列数据
- 检查数据中是否有空值或非数字内容

### 问题3：预测结果异常
**解决方案**：
- 检查输入数据格式和范围
- 确认模型文件完整性
- 查看浏览器控制台错误信息

## 🌐 免费云端部署（推荐）

### 🆓 让全世界都能访问您的系统

通过免费云平台，任何人在任何地方都可以访问您的HCF疲劳预测系统！

**🌟 Railway部署（强烈推荐）**：
1. 访问 https://railway.app
2. 用GitHub账号登录  
3. 选择本项目仓库
4. 自动部署，3分钟获得全球访问地址
5. **成本：完全免费（500小时/月）**

**🔄 Render部署（备选方案）**：
1. 访问 https://render.com
2. 用GitHub账号登录
3. 创建Web Service，选择本项目
4. **成本：完全免费（750小时/月）**

**✅ 免费方案优势**：
- ✅ **零成本** - 无需信用卡，完全免费
- ✅ **一键部署** - 3分钟自动完成部署  
- ✅ **全球访问** - 北京、纽约、伦敦都能访问
- ✅ **自动更新** - 代码更新时自动重新部署
- ✅ **免费域名** - 自动分配访问地址
- ✅ **HTTPS加密** - 安全的数据传输

**📱 部署后效果**：
```
Railway示例: https://hcf-prediction-production.up.railway.app
Render示例:  https://hcf-prediction.onrender.com

全世界任何地方的用户都可以直接访问！
```

📖 **详细教程**：查看 `免费部署指南.md` 文件

## 📦 项目打包

本项目提供了多种打包方式，适用于不同的部署需求：

### 🚀 快速打包（推荐）

**Windows用户**：
```bash
# 双击运行自动打包脚本
package.bat
```

**所有平台**：
```bash
# 1. 安装依赖
pip install -r requirements.txt

# 2. 选择打包方式
python build_exe.py        # 打包为exe文件
docker build -t hcf .       # 创建Docker镜像
python -m build             # 创建Python包
```

### 📋 打包方式详解

#### 1. **独立可执行文件** (推荐给最终用户)
```bash
python build_exe.py
```
**优点**：
- 无需安装Python环境
- 双击即可运行
- 包含所有依赖

**输出**：`dist/HCF疲劳预测系统.exe`

#### 2. **Docker容器** (推荐服务器部署)
```bash
# 构建镜像
docker build -t hcf-prediction .

# 运行容器
docker run -p 5000:5000 hcf-prediction
```
**优点**：
- 环境隔离
- 部署简单
- 可扩展

#### 3. **Python包** (推荐开发者)
```bash
pip install build
python -m build
```
**优点**：
- 标准Python包
- 可通过pip安装
- 方便分发

**输出**：`dist/hcf_prediction-1.0.0-py3-none-any.whl`

#### 4. **便携版** (推荐教学使用)
使用`package.bat`选择"便携版"，或手动：
```bash
# 复制项目文件
xcopy HCF_Prediction\pythonProject2 HCF_Portable\app /E /I
copy requirements.txt HCF_Portable\
copy README.md HCF_Portable\
```
**优点**：
- 源码可见
- 易于修改
- 教学友好

### 🎯 打包文件使用说明

| 部署方式 | 成本 | 启动方式 | 适用场景 | 推荐指数 |
|---------|------|---------|---------|----------|
| **免费云端** | 🆓免费 | 网页访问 | **全球分享** | ⭐⭐⭐⭐⭐ |
| exe文件 | 🆓免费 | 双击exe | 个人使用 | ⭐⭐⭐⭐ |
| Docker镜像 | 💰付费 | docker run | 服务器部署 | ⭐⭐⭐ |
| Python包 | 🆓免费 | pip install | 开发分发 | ⭐⭐ |
| 便携版 | 🆓免费 | 运行bat脚本 | 教学演示 | ⭐⭐⭐ |

### ⚙️ 高级配置

**自定义启动参数**：
```python
# 修改 start.py 中的参数
app.run(
    host='0.0.0.0',      # 监听所有IP
    port=8080,           # 自定义端口
    debug=False          # 生产环境关闭debug
)
```

**Docker环境变量**：
```bash
docker run -p 5000:5000 \
    -e FLASK_ENV=production \
    -e MODEL_PATH=/app/models \
    hcf-prediction
```

## 👨‍💻 开发信息

- **开发语言**：Python
- **框架版本**：Flask 2.0+
- **模型算法**：Random Forest Regressor
- **数据格式**：Excel (pandas + openpyxl)

---

## 🎊 推荐使用方式

### 🌟 想要全球分享？→ **免费云端部署**
- 3分钟部署到Railway，获得全球访问地址
- 同事、客户、朋友都能直接访问
- 完全免费，无需服务器维护

### 💻 想要个人使用？→ **exe文件**
- 双击即用，无需安装Python
- 本地运行，数据隐私安全
- 适合日常工作使用

### 📚 想要教学演示？→ **便携版**
- 源码可见，方便修改学习
- 适合课堂教学和技术分享

---

**🎯 HCF疲劳预测系统能够帮助材料工程师快速评估钢材的疲劳性能，支持单个样本和批量数据处理，为产品设计和材料选择提供科学依据。现在通过免费云端部署，让全世界都能使用您的预测系统！** 